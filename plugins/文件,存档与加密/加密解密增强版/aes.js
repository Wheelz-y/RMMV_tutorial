/*AES implementation in JavaScript (c) Chris Veness 2005-2012 - see http://csrc.nist.gov/publications/PubsFIPS.html#197 */var Aes={cipher:function(a,b){for(var c=b.length/4-1,e=[[],[],[],[]],d=0;16>d;d++)e[d%4][Math.floor(d/4)]=a[d];e=Aes.addRoundKey(e,b,0,4);for(d=1;d<c;d++)e=Aes.subBytes(e,4),e=Aes.shiftRows(e,4),e=Aes.mixColumns(e,4),e=Aes.addRoundKey(e,b,d,4);e=Aes.subBytes(e,4);e=Aes.shiftRows(e,4);e=Aes.addRoundKey(e,b,c,4);b=Array(16);for(d=0;16>d;d++)b[d]=e[d%4][Math.floor(d/4)];return b},keyExpansion:function(a){for(var b=a.length/4,c=b+6,e=Array(4*(c+1)),d=Array(4),g=0;g<b;g++)e[g]=[a[4*g],a[4*g+1],a[4*g+2],a[4*g+3]];for(g=b;g<4*(c+1);g++){e[g]=Array(4);for(a=0;4>a;a++)d[a]=e[g-1][a];if(0==g%b)for(d=Aes.subWord(Aes.rotWord(d)),a=0;4>a;a++)d[a]^=Aes.rCon[g/b][a];else 6<b&&4==g%b&&(d=Aes.subWord(d));for(a=0;4>a;a++)e[g][a]=e[g-b][a]^d[a]}return e},subBytes:function(a,b){for(var c=0;4>c;c++)for(var e=0;e<b;e++)a[c][e]=Aes.sBox[a[c][e]];return a},shiftRows:function(a,b){for(var c=Array(4),e=1;4>e;e++){for(var d=0;4>d;d++)c[d]=a[e][(d+e)%b];for(d=0;4>d;d++)a[e][d]=c[d]}return a},mixColumns:function(a,b){for(b=0;4>b;b++){for(var c=Array(4),e=Array(4),d=0;4>d;d++)c[d]=a[d][b],e[d]=a[d][b]&128?a[d][b]<<1^283:a[d][b]<<1;a[0][b]=e[0]^c[1]^e[1]^c[2]^c[3];a[1][b]=c[0]^e[1]^c[2]^e[2]^c[3];a[2][b]=c[0]^c[1]^e[2]^c[3]^e[3];a[3][b]=c[0]^e[0]^c[1]^c[2]^e[3]}return a},addRoundKey:function(a,b,c,e){for(var d=0;4>d;d++)for(var g=0;g<e;g++)a[d][g]^=b[4*c+g][d];return a},subWord:function(a){for(var b=0;4>b;b++)a[b]=Aes.sBox[a[b]];return a},rotWord:function(a){for(var b=a[0],c=0;3>c;c++)a[c]=a[c+1];a[3]=b;return a},sBox:[99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22],rCon:[[0,0,0,0],[1,0,0,0],[2,0,0,0],[4,0,0,0],[8,0,0,0],[16,0,0,0],[32,0,0,0],[64,0,0,0],[128,0,0,0],[27,0,0,0],[54,0,0,0]],Ctr:{}};Aes.Ctr.getKeySchedule=function(a,b){var c="string"==typeof a;a=c?Utf8.encode(a):a;c=c?function(b){return a.charCodeAt(b)}:function(b){return a[b]};b/=8;for(var e=Array(b),d=0;d<b;d++)e[d]=isNaN(c(d))?0:c(d)||0;c=Aes.cipher(e,Aes.keyExpansion(e));c=c.concat(c.slice(0,b-16));return Aes.keyExpansion(c)};Aes.Ctr.encrypt=function(a,b,c,e){if(128!=c&&192!=c&&256!=c)return"";var d="string"==typeof a;a=d?Utf8.encode(a):a;for(var d=d?function(b){return a.charCodeAt(b)}:function(b){return a[b]},g=e?function(a){return a}:function(a){return String.fromCharCode(a)},h=Array(16),f=(new Date).getTime(),l=f%1E3,m=Math.floor(f/1E3),k=Math.floor(65535*Math.random()),f=0;2>f;f++)h[f]=l>>>8*f&255;for(f=0;2>f;f++)h[f+2]=k>>>8*f&255;for(f=0;4>f;f++)h[f+4]=m>>>8*f&255;k=a.length||a.byteLength||0;l=e&&1!=e?new Uint8Array(k+8):Array(k+8);for(m=f=0;8>f;f++,m++)l[m]=g(h[f]);b=this.getKeySchedule(b,c);c=Math.ceil(k/16);for(k=0;k<c;k++){for(f=0;4>f;f++)h[15-f]=k>>>8*f&255;for(f=0;4>f;f++)h[15-f-4]=k/4294967296>>>8*f;for(var n=Aes.cipher(h,b),p=k<c-1?16:(a.length-1)%16+1,f=0;f<p;f++,m++)l[m]=g(n[f]^d(16*k+f))}return e?l:l.join("")};Aes.Ctr.decrypt=function(a,b,c,e){if(128!=c&&192!=c&&256!=c)return"";for(var d="string"==typeof a?function(b){return a.charCodeAt(b)}:function(b){return a[b]},g=e?function(a){return a}:function(a){return String.fromCharCode(a)},h=Array(8),f=0;8>f;f++)h[f]=d(f);b=this.getKeySchedule(b,c);f=a.length||a.byteLength||0;c=e&&1!=e?new Uint8Array(f-8):Array(f-8);for(var l=Math.ceil((f-8)/16),m=Array(l),k=0;k<l-1;k++)m[k]=16;m[k]=f-8-16*k;for(var n=k=0,p=8;k<l;k++){for(f=0;4>f;f++)h[15-f]=k>>>8*f&255;for(f=0;4>f;f++)h[15-f-4]=(k+1)/4294967296-1>>>8*f&255;for(var q=Aes.cipher(h,b),f=0;f<m[k];f++,n++,p++)c[n]=g(q[f]^d(p))}return e?c:Utf8.decode(c.join(""))};var Base64={code:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d",encode:function(a,b){var c,e,d,g,h=[],f="",l=Base64.code;b=("undefined"==typeof b?0:b)?a.encodeUTF8():a;a=b.length%3;if(0<a)for(;3>a++;)f+="\x3d",b+="\x00";for(a=0;a<b.length;a+=3)c=b.charCodeAt(a),e=b.charCodeAt(a+1),d=b.charCodeAt(a+2),g=c<<16|e<<8|d,c=g>>18&63,e=g>>12&63,d=g>>6&63,g&=63,h[a/3]=l.charAt(c)+l.charAt(e)+l.charAt(d)+l.charAt(g);h=h.join("");return h.slice(0,h.length-f.length)+f},decode:function(a,b){b="undefined"==typeof b?!1:b;var c,e,d,g,h=[],f,l=Base64.code;f=b?a.decodeUTF8():a;for(var m=0;m<f.length;m+=4)c=l.indexOf(f.charAt(m)),e=l.indexOf(f.charAt(m+1)),a=l.indexOf(f.charAt(m+2)),g=l.indexOf(f.charAt(m+3)),d=c<<18|e<<12|a<<6|g,c=d>>>16&255,e=d>>>8&255,d&=255,h[m/4]=String.fromCharCode(c,e,d),64==g&&(h[m/4]=String.fromCharCode(c,e)),64==a&&(h[m/4]=String.fromCharCode(c));h=h.join("");return b?h.decodeUTF8():h}},Utf8={encode:function(a){a=a.replace(/[\u0080-\u07ff]/g,function(a){a=a.charCodeAt(0);return String.fromCharCode(192|a>>6,128|a&63)});return a=a.replace(/[\u0800-\uffff]/g,function(a){a=a.charCodeAt(0);return String.fromCharCode(224|a>>12,128|a>>6&63,128|a&63)})},decode:function(a){a=a.replace(/[\u00e0-\u00ef][\u0080-\u00bf][\u0080-\u00bf]/g,function(a){a=(a.charCodeAt(0)&15)<<12|(a.charCodeAt(1)&63)<<6|a.charCodeAt(2)&63;return String.fromCharCode(a)});return a=a.replace(/[\u00c0-\u00df][\u0080-\u00bf]/g,function(a){a=(a.charCodeAt(0)&31)<<6|a.charCodeAt(1)&63;return String.fromCharCode(a)})}};